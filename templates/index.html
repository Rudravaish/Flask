<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skin Lesion Classifier - AI-Powered Medical Analysis</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .medical-header {
            background: linear-gradient(135deg, var(--bs-primary) 0%, var(--bs-info) 100%);
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        .upload-zone {
            border: 2px dashed var(--bs-border-color);
            border-radius: 0.5rem;
            padding: 3rem 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-zone:hover {
            border-color: var(--bs-primary);
            background-color: rgba(var(--bs-primary-rgb), 0.05);
        }
        .upload-zone.dragover {
            border-color: var(--bs-success);
            background-color: rgba(var(--bs-success-rgb), 0.1);
        }
        .result-card {
            background: var(--bs-body-bg);
            border: 1px solid var(--bs-border-color);
            border-radius: 0.5rem;
            padding: 2rem;
            margin-top: 2rem;
        }
        .confidence-bar {
            height: 1rem;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .suspicious {
            color: var(--bs-warning);
        }
        .benign {
            color: var(--bs-success);
        }
        .medical-disclaimer {
            background-color: rgba(var(--bs-warning-rgb), 0.1);
            border: 1px solid var(--bs-warning);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="medical-header">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h1 class="display-4 fw-bold text-white mb-3">
                        <i class="fas fa-stethoscope me-3"></i>
                        Skin Lesion Classifier
                    </h1>
                    <p class="lead text-white-50">
                        AI-powered analysis for skin lesion assessment
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'info-circle' }} me-2"></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="row">
            <div class="col-lg-6">
                <!-- Upload Form -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-upload me-2"></i>
                            Upload Lesion Image
                        </h3>
                    </div>
                    <div class="card-body">
                        <form method="POST" enctype="multipart/form-data" id="uploadForm">
                            <div class="upload-zone" id="uploadZone">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <h4>Click to upload or drag and drop</h4>
                                <p class="text-muted">
                                    Supported formats: PNG, JPG, JPEG, GIF, BMP, WebP<br>
                                    Maximum size: 16MB
                                </p>
                                <input type="file" name="image" id="imageInput" accept="image/*" required class="d-none">
                                <button type="button" class="btn btn-primary" onclick="document.getElementById('imageInput').click()">
                                    <i class="fas fa-folder-open me-2"></i>
                                    Choose File
                                </button>
                            </div>
                            
                            <div id="fileInfo" class="mt-3 d-none">
                                <div class="alert alert-info">
                                    <i class="fas fa-file-image me-2"></i>
                                    <span id="fileName"></span>
                                </div>
                            </div>
                            
                            <!-- Fitzpatrick Skin Type with Reference -->
                            <div class="mt-4">
                                <label for="skin_type" class="form-label">
                                    <i class="fas fa-palette me-2"></i>
                                    <strong>Fitzpatrick Skin Type</strong>
                                </label>
                                <select name="skin_type" id="skin_type" class="form-select" required>
                                    <option value="I" {% if skin_type == 'I' %}selected{% endif %}>Type I</option>
                                    <option value="II" {% if skin_type == 'II' %}selected{% endif %}>Type II</option>
                                    <option value="III" {% if skin_type == 'III' %}selected{% endif %}>Type III</option>
                                    <option value="IV" {% if skin_type == 'IV' %}selected{% endif %}>Type IV</option>
                                    <option value="V" {% if skin_type == 'V' %}selected{% endif %}>Type V</option>
                                    <option value="VI" {% if skin_type == 'VI' %}selected{% endif %}>Type VI</option>
                                </select>
                                
                                <!-- Fitzpatrick Reference Patches -->
                                <div class="mt-3 p-3 border rounded bg-light">
                                    <small class="text-muted d-block mb-2">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Reference Guide - Select the skin tone closest to yours:
                                    </small>
                                    <div class="row g-2">
                                        <div class="col-2 text-center">
                                            <div class="skin-patch position-relative" style="background-color: #fdbcb4; height: 30px; border-radius: 4px; border: 1px solid #ddd;">
                                                <span class="position-absolute top-50 start-50 translate-middle" style="font-size: 10px; font-weight: bold; color: #333;">Type I</span>
                                            </div>
                                        </div>
                                        <div class="col-2 text-center">
                                            <div class="skin-patch position-relative" style="background-color: #f1c27d; height: 30px; border-radius: 4px; border: 1px solid #ddd;">
                                                <span class="position-absolute top-50 start-50 translate-middle" style="font-size: 10px; font-weight: bold; color: #333;">Type II</span>
                                            </div>
                                        </div>
                                        <div class="col-2 text-center">
                                            <div class="skin-patch position-relative" style="background-color: #e0ac69; height: 30px; border-radius: 4px; border: 1px solid #ddd;">
                                                <span class="position-absolute top-50 start-50 translate-middle" style="font-size: 10px; font-weight: bold; color: #333;">Type III</span>
                                            </div>
                                        </div>
                                        <div class="col-2 text-center">
                                            <div class="skin-patch position-relative" style="background-color: #c68642; height: 30px; border-radius: 4px; border: 1px solid #ddd;">
                                                <span class="position-absolute top-50 start-50 translate-middle" style="font-size: 10px; font-weight: bold; color: #fff;">Type IV</span>
                                            </div>
                                        </div>
                                        <div class="col-2 text-center">
                                            <div class="skin-patch position-relative" style="background-color: #8d5524; height: 30px; border-radius: 4px; border: 1px solid #ddd;">
                                                <span class="position-absolute top-50 start-50 translate-middle" style="font-size: 10px; font-weight: bold; color: #fff;">Type V</span>
                                            </div>
                                        </div>
                                        <div class="col-2 text-center">
                                            <div class="skin-patch position-relative" style="background-color: #614335; height: 30px; border-radius: 4px; border: 1px solid #ddd;">
                                                <span class="position-absolute top-50 start-50 translate-middle" style="font-size: 10px; font-weight: bold; color: #fff;">Type VI</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Body Part Location -->
                            <div class="mt-4">
                                <label for="body_part" class="form-label">
                                    <i class="fas fa-body me-2"></i>
                                    <strong>Body Part Location</strong>
                                </label>
                                <select class="form-select" name="body_part" id="body_part" required>
                                    <option value="trunk_back">Back/Trunk (High Risk)</option>
                                    <option value="trunk_chest">Chest/Abdomen (High Risk)</option>
                                    <option value="head_neck">Head/Neck/Face (High Risk)</option>
                                    <option value="shoulders">Shoulders (High Risk)</option>
                                    <option value="arms_upper">Upper Arms (Moderate Risk)</option>
                                    <option value="arms_lower">Lower Arms/Hands (Moderate Risk)</option>
                                    <option value="legs_upper">Upper Legs/Thighs (Moderate Risk)</option>
                                    <option value="legs_lower">Lower Legs/Feet (Lower Risk)</option>
                                    <option value="palms_soles">Palms/Soles (Special Consideration)</option>
                                    <option value="genital_area">Genital Area (Special Consideration)</option>
                                    <option value="other">Other Location</option>
                                </select>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Location affects melanoma risk - sun-exposed areas have higher rates
                                </div>
                            </div>

                            <!-- Evolution Tracking (E in ABCDE) -->
                            <div class="mt-4">
                                <label class="form-label">
                                    <i class="fas fa-clock me-2"></i>
                                    <strong>Evolution - Has this lesion changed over time?</strong>
                                </label>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="has_evolved" id="evolved_no" value="no" checked>
                                            <label class="form-check-label" for="evolved_no">
                                                No changes noticed
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="has_evolved" id="evolved_yes" value="yes">
                                            <label class="form-check-label" for="evolved_yes">
                                                Yes, it has changed
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <label for="evolution_weeks" class="form-label small">If yes, for how many weeks?</label>
                                        <input type="number" class="form-control" name="evolution_weeks" id="evolution_weeks" min="0" max="104" placeholder="Number of weeks">
                                    </div>
                                </div>
                                <div class="form-text">
                                    <i class="fas fa-exclamation-triangle me-1 text-warning"></i>
                                    Changes in size, shape, color, or texture are concerning signs
                                </div>
                            </div>

                            <!-- Manual Measurements -->
                            <div class="mt-4">
                                <label class="form-label">
                                    <i class="fas fa-ruler me-2"></i>
                                    <strong>Manual Measurements (Optional)</strong>
                                </label>
                                <div class="row">
                                    <div class="col-6">
                                        <label for="manual_length" class="form-label small">Length (mm)</label>
                                        <input type="number" class="form-control" name="manual_length" id="manual_length" min="0" max="200" step="0.1" placeholder="e.g., 6.5">
                                    </div>
                                    <div class="col-6">
                                        <label for="manual_width" class="form-label small">Width (mm)</label>
                                        <input type="number" class="form-control" name="manual_width" id="manual_width" min="0" max="200" step="0.1" placeholder="e.g., 4.2">
                                    </div>
                                </div>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Providing measurements improves diameter analysis accuracy
                                </div>
                            </div>
                            
                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-success btn-lg" id="analyzeBtn" disabled>
                                    <i class="fas fa-microscope me-2"></i>
                                    Analyze Image
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                {% if result %}
                <!-- Results -->
                <div class="result-card">
                    <h3 class="mb-4">
                        <i class="fas fa-chart-line me-2"></i>
                        Analysis Results
                    </h3>
                    
                    <!-- Prediction -->
                    <div class="mb-4">
                        <h4 class="mb-2">Classification:</h4>
                        <span class="badge fs-5 {{ 'bg-warning' if result == 'Suspicious' else 'bg-success' }}">
                            <i class="fas fa-{{ 'exclamation-triangle' if result == 'Suspicious' else 'check-circle' }} me-2"></i>
                            {{ result }}
                        </span>
                    </div>
                    
                    <!-- Confidence -->
                    <div class="mb-4">
                        <h4 class="mb-2">Confidence Score:</h4>
                        <div class="d-flex align-items-center">
                            <div class="confidence-bar bg-secondary flex-grow-1 me-3">
                                <div class="bg-{{ 'warning' if result == 'Suspicious' else 'success' }} h-100" 
                                     style="width: {{ confidence }}%;"></div>
                            </div>
                            <span class="fw-bold">{{ confidence }}%</span>
                        </div>
                    </div>
                    
                    <!-- Skin Type Information -->
                    {% if skin_type %}
                    <div class="mb-4">
                        <h4 class="mb-2">Skin Type Analyzed:</h4>
                        <span class="badge bg-info fs-6">
                            <i class="fas fa-user me-2"></i>
                            Fitzpatrick Type {{ skin_type }}
                        </span>
                    </div>
                    {% endif %}
                    
                    <!-- Data Limitation Warning for Darker Skin Types -->
                    <div class="alert alert-info" role="alert">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Improving AI for All:</strong> While our model performs well across skin types, we're actively working to enhance accuracy for darker skin tones through expanded training data. This tool is for reference only and should not replace professional medical consultation.
                    </div>
                    
                    <!-- Uploaded Image -->
                    {% if image_path %}
                    <div class="mb-3">
                        <h4 class="mb-2">Analyzed Image:</h4>
                        <img src="{{ image_path }}" alt="Uploaded lesion image" class="image-preview">
                    </div>
                    {% endif %}
                    
                    <!-- Analysis Details -->
                    {% if analysis_summary %}
                    <div class="mt-4">
                        <h5 class="text-primary mb-3">
                            <i class="fas fa-chart-line me-2"></i>Analysis Details
                        </h5>
                        
                        <h4 class="mb-3" style="color: black;">
                            <i class="fas fa-list-check me-2"></i>
                            ABCDE Feature Analysis
                        </h4>
                        
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Feature Scores</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p style="color: white; font-weight: bold;"><strong>Asymmetry:</strong> 
                                            <span class="badge {% if analysis_summary.features.asymmetry > 0.6 %}bg-danger{% elif analysis_summary.features.asymmetry > 0.4 %}bg-warning{% else %}bg-success{% endif %}" style="color: white; font-weight: bold;">
                                                {{ "%.2f"|format(analysis_summary.features.asymmetry) }}
                                            </span>
                                        </p>
                                        <p style="color: white; font-weight: bold;"><strong>Border Irregularity:</strong> 
                                            <span class="badge {% if analysis_summary.features.border > 0.6 %}bg-danger{% elif analysis_summary.features.border > 0.4 %}bg-warning{% else %}bg-success{% endif %}" style="color: white; font-weight: bold;">
                                                {{ "%.2f"|format(analysis_summary.features.border) }}
                                            </span>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p style="color: white; font-weight: bold;"><strong>Color Variation:</strong> 
                                            <span class="badge {% if analysis_summary.features.color > 0.6 %}bg-danger{% elif analysis_summary.features.color > 0.4 %}bg-warning{% else %}bg-success{% endif %}" style="color: white; font-weight: bold;">
                                                {{ "%.2f"|format(analysis_summary.features.color) }}
                                            </span>
                                        </p>
                                        <p style="color: white; font-weight: bold;"><strong>Diameter/Size:</strong> 
                                            <span class="badge {% if analysis_summary.features.diameter > 0.6 %}bg-danger{% elif analysis_summary.features.diameter > 0.4 %}bg-warning{% else %}bg-success{% endif %}" style="color: white; font-weight: bold;">
                                                {{ "%.2f"|format(analysis_summary.features.diameter) }}
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <p style="color: white; font-weight: bold;"><strong>Detected Skin Type:</strong> 
                                        <span class="badge bg-info" style="color: white; font-weight: bold;">{{ analysis_summary.detected_skin_tone }}</span>
                                    </p>
                                    <p style="color: white; font-weight: bold;"><strong>Analysis Method:</strong> 
                                        <span class="badge bg-secondary" style="color: white; font-weight: bold;">
                                            {% if analysis_summary.analysis_type == 'darker_skin_specialized' %}
                                                Enhanced for Darker Skin Tones
                                            {% else %}
                                                Standard Analysis
                                            {% endif %}
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <h4 class="mb-3 mt-4" style="color: black;">
                            <i class="fas fa-lightbulb me-2"></i>
                            Understanding Your Results
                        </h4>
                        
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Score Interpretation</h6>
                            </div>
                            <div class="card-body">
                                <ul class="mb-0">
                                    <li style="color: white; font-weight: bold;"><strong>Green scores (0.0-0.4):</strong> Features appear normal</li>
                                    <li style="color: white; font-weight: bold;"><strong>Yellow scores (0.4-0.6):</strong> Some irregularity detected</li>
                                    <li style="color: white; font-weight: bold;"><strong>Red scores (0.6-1.0):</strong> Concerning features present</li>
                                </ul>
                                <p class="mt-3 small" style="color: white;">
                                    Higher scores indicate features more commonly seen in malignant lesions. 
                                    This analysis is optimized for your skin type to improve accuracy.
                                </p>
                            </div>
                        </div>
                        
                        <!-- Future Recommendations -->
                        <h4 class="mb-3 mt-4" style="color: black;">
                            <i class="fas fa-calendar-check me-2"></i>
                            Future Recommendations
                        </h4>
                        
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0" style="color: black; font-weight: bold;">Next Steps Based on Your Results</h6>
                            </div>
                            <div class="card-body">
                                {% if result == 'Highly Suspicious' or result == 'Suspicious' %}
                                <div class="alert alert-warning mb-3">
                                    <h6 style="color: #856404; font-weight: bold;"><i class="fas fa-exclamation-triangle me-2"></i>Urgent Action Required</h6>
                                    <ul class="mb-0" style="color: #856404;">
                                        <li><strong>Schedule a dermatologist appointment immediately</strong></li>
                                        <li>Do not delay - contact your healthcare provider within 1-2 weeks</li>
                                        <li>Take photos to track any changes before your appointment</li>
                                        <li>Avoid excessive sun exposure to the area</li>
                                    </ul>
                                </div>
                                {% elif result == 'Moderately Concerning' %}
                                <div class="alert alert-info mb-3">
                                    <h6 style="color: #0c5460; font-weight: bold;"><i class="fas fa-info-circle me-2"></i>Monitor and Schedule</h6>
                                    <ul class="mb-0" style="color: #0c5460;">
                                        <li><strong>Schedule a routine dermatologist visit within 1-3 months</strong></li>
                                        <li>Monitor the lesion weekly for any changes</li>
                                        <li>Take monthly photos to track evolution</li>
                                        <li>Use sun protection when outdoors</li>
                                    </ul>
                                </div>
                                {% else %}
                                <div class="alert alert-success mb-3">
                                    <h6 style="color: #0a3622; font-weight: bold;"><i class="fas fa-check-circle me-2"></i>Continue Monitoring</h6>
                                    <ul class="mb-0" style="color: #0a3622;">
                                        <li><strong>Continue regular self-examinations monthly</strong></li>
                                        <li>Schedule annual skin check with dermatologist</li>
                                        <li>Watch for any changes in size, color, or texture</li>
                                        <li>Maintain good sun protection habits</li>
                                    </ul>
                                </div>
                                {% endif %}
                                
                                <h6 class="mt-3" style="color: white; font-weight: bold;">General Prevention Tips:</h6>
                                <ul class="small" style="color: white;">
                                    <li>Use broad-spectrum SPF 30+ sunscreen daily</li>
                                    <li>Perform monthly self-skin examinations</li>
                                    <li>Avoid peak sun hours (10 AM - 4 PM)</li>
                                    <li>Wear protective clothing and wide-brimmed hats</li>
                                    <li>Report any new or changing moles to your doctor</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Additional Information -->
                    <div class="mt-4">
                        <h5 class="text-muted">About This Analysis</h5>
                        <p class="small text-muted">
                            This AI analysis uses advanced computer vision and medical criteria (ABCDE) to evaluate skin lesions. 
                            It is designed as a screening tool and should not replace professional medical evaluation.
                            <strong>Always consult a dermatologist for definitive diagnosis and treatment recommendations.</strong>
                        </p>
                        <p class="small text-muted">
                            The analysis considers factors such as asymmetry, border irregularity, color variation, 
                            diameter, and evolution patterns commonly associated with malignant lesions.
                        </p>
                    </div>
                </div>
                {% else %}
                <!-- Instructions -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            How to Use
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex mb-3">
                                    <div class="flex-shrink-0">
                                        <span class="badge bg-primary rounded-pill">1</span>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h5>Upload Image</h5>
                                        <p class="text-muted">Select a clear, well-lit image of the skin lesion.</p>
                                    </div>
                                </div>
                                
                                <div class="d-flex mb-3">
                                    <div class="flex-shrink-0">
                                        <span class="badge bg-primary rounded-pill">2</span>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h5>Select Skin Type</h5>
                                        <p class="text-muted">Choose your Fitzpatrick skin type to improve analysis accuracy and account for potential model bias.</p>
                                    </div>
                                </div>
                                
                                <div class="d-flex mb-3">
                                    <div class="flex-shrink-0">
                                        <span class="badge bg-primary rounded-pill">3</span>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h5>AI Analysis</h5>
                                        <p class="text-muted">Our system analyzes the image using advanced machine learning and medical criteria.</p>
                                    </div>
                                </div>
                                
                                <div class="d-flex">
                                    <div class="flex-shrink-0">
                                        <span class="badge bg-primary rounded-pill">4</span>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h5>Get Results</h5>
                                        <p class="text-muted">Review the classification, confidence score, and any bias warnings for your skin type.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Medical Disclaimer -->
        <div class="medical-disclaimer">
            <h4 class="text-warning mb-3">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Medical Disclaimer
            </h4>
            <p class="mb-2">
                <strong>This tool is for educational purposes only and should not be used for medical diagnosis.</strong>
            </p>
            <p class="mb-0">
                Always consult with a qualified healthcare professional for proper medical evaluation and diagnosis. 
                This AI system is not a substitute for professional medical advice, diagnosis, or treatment.
            </p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // File upload handling
        const uploadZone = document.getElementById('uploadZone');
        const imageInput = document.getElementById('imageInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const analyzeBtn = document.getElementById('analyzeBtn');

        // Click to upload
        uploadZone.addEventListener('click', () => {
            imageInput.click();
        });

        // Drag and drop functionality
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                imageInput.files = files;
                handleFileSelection();
            }
        });

        // File selection handler
        imageInput.addEventListener('change', handleFileSelection);

        function handleFileSelection() {
            const file = imageInput.files[0];
            if (file) {
                fileName.textContent = file.name + ' (' + formatFileSize(file.size) + ')';
                fileInfo.classList.remove('d-none');
                analyzeBtn.disabled = false;
            } else {
                fileInfo.classList.add('d-none');
                analyzeBtn.disabled = true;
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Form submission handling
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Analyzing...';
            analyzeBtn.disabled = true;
        });
    </script>
</body>
</html>
